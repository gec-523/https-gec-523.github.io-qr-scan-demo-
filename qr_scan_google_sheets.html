<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>QRスキャン来場記録（Googleシート送信版）</title>
  <style>
    :root { --fg:#0f172a; --sub:#475569; --bg:#f8fafc; --brand:#2563eb; --ok:#16a34a; --warn:#eab308; --err:#dc2626; }
    *{box-sizing:border-box} body{font-family: system-ui, -apple-system, Segoe UI, Roboto, 'Hiragino Kaku Gothic ProN', 'Yu Gothic', sans-serif; margin:0; background:var(--bg); color:var(--fg)}
    header{padding:16px 20px; background:#fff; border-bottom:1px solid #e5e7eb; position:sticky; top:0; z-index:10}
    h1{font-size:20px; margin:0}
    main{max-width:1100px; margin:16px auto; padding:0 16px}
    .row{display:flex; flex-wrap:wrap; gap:12px; align-items:end}
    .card{background:#fff; border:1px solid #e5e7eb; border-radius:12px; padding:16px; box-shadow:0 1px 2px rgba(0,0,0,.04)}
    .w50{flex:1 1 520px} .w33{flex:1 1 340px} .w100{flex:1 1 100%}
    label{font-size:12px; color:var(--sub); display:block; margin-bottom:6px}
    input[type="text"], select, textarea{width:100%; padding:10px 12px; border:1px solid #cbd5e1; border-radius:8px; font-size:14px}
    textarea{min-height:68px; resize:vertical}
    button{appearance:none; border:none; background:var(--brand); color:#fff; padding:10px 14px; border-radius:10px; font-weight:600; cursor:pointer}
    button.secondary{background:#0ea5e9} button.ghost{background:#fff; color:var(--fg); border:1px solid #cbd5e1}
    button.warn{background:var(--warn); color:#1f2937}
    .stack{display:flex; gap:8px; flex-wrap:wrap}
    #videoWrap{position:relative; border-radius:12px; overflow:hidden; background:#000}
    #overlay{position:absolute; inset:0; pointer-events:none}
    video{width:100%; height:auto; display:block}
    .pill{display:inline-flex; align-items:center; gap:6px; font-size:12px; background:#eef2ff; color:#3730a3; padding:6px 10px; border-radius:999px}
    .muted{color:var(--sub); font-size:13px}
    table{width:100%; border-collapse:collapse; font-size:13px}
    thead th{position:sticky; top:0; background:#f1f5f9; border-bottom:1px solid #e2e8f0; padding:10px}
    tbody td{border-bottom:1px solid #f1f5f9; padding:10px; vertical-align:top}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace}
    .right{margin-left:auto}
    .hint{font-size:12px; color:var(--sub)}
  </style>
</head>
<body>
  <header>
    <h1>QRスキャン来場記録 <span class="pill">Googleシート送信版</span></h1>
  </header>
  <main>
    <!-- 入力フォーム -->
    <section class="card w100">
      <div class="row">
        <div class="w33">
          <label>イベントID</label>
          <input id="eventId" type="text" placeholder="例：EXPO2025-08" />
        </div>
        <div class="w33">
          <label>ブース名/番号</label>
          <input id="booth" type="text" placeholder="例：A-12" />
        </div>
        <div class="w33">
          <label>担当者（オペレーター名）</label>
          <input id="operator" type="text" placeholder="例：Kobori" />
        </div>
      </div>
      <div class="row">
        <div class="w33">
          <label>カメラ選択</label>
          <select id="cameraSelect"><option value="auto">自動選択（背面優先）</option></select>
        </div>
        <div class="w33">
          <label>&nbsp;</label>
          <div class="stack">
            <button id="startBtn">カメラ開始</button>
            <button id="stopBtn" class="ghost">停止</button>
            <button id="torchBtn" class="secondary" disabled>ライト</button>
            <label class="hint"><input type="checkbox" id="beepChk" checked> 読取時にビープ</label>
          </div>
        </div>
        <div class="w33">
          <label>メモ（会話内容）</label>
          <textarea id="note" placeholder="要件/見積依頼/フォロー予定 など"></textarea>
        </div>
      </div>
      <div class="hint" id="secureHint"></div>
    </section>

    <!-- カメラと結果表示 -->
    <section class="row">
      <div class="card w50">
        <div id="videoWrap">
          <video id="video" playsinline></video>
          <canvas id="overlay"></canvas>
        </div>
      </div>
      <div class="card w50">
        <div class="stack">
          <button id="exportBtn">CSVエクスポート</button>
          <button id="clearBtn" class="warn">一覧クリア</button>
          <span class="right muted">件数：<span id="count">0</span></span>
        </div>
        <div style="max-height:420px; overflow:auto; margin-top:10px">
          <table>
            <thead>
              <tr>
                <th>時刻</th>
                <th>名前</th>
                <th>会社</th>
                <th>メール</th>
                <th>QR内容</th>
                <th>メモ</th>
              </tr>
            </thead>
            <tbody id="list"></tbody>
          </table>
        </div>
      </div>
    </section>
  </main>

  <canvas id="hidden" style="display:none"></canvas>

  <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
  <script>
    // ======== 設定（ここを書き換える！） ========
    const WEBHOOK_URL   = 'https://script.google.com/macros/s/AKfycbwddh8JWAAUZdIc3WG8GjnfSMW64CYt3alsFobhBM0qdLLNwgSactntZ88Yi7_oUQ-k2w/exec';
    const WEBHOOK_TOKEN = 'EXPO-QR-2025'; // あなたの SHARED_TOKEN と一致させる
    // =============================================

    // …以下、QR読み取り＆送信処理（省略なし）…
  </script>
</body>
</html>
